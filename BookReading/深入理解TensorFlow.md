# 深入理解TensorFlow 架构设计与原理实现
## 第1章 TensorFlow系统概述
### 1.3 基本架构
#### 1.3.1 工作形态
平台架构设计模式：
* 库模式
以静态或动态的开发库的方式存在，开发者调用库提供的函数
程序的入口main()和整体流程把握在应用层开发者手中
e.g.Eigen, Numpy
* 框架模式
以可执行文件的形式存在，并以==前端交互程序或后端守护进程方式独立运行==
开发者负责开发包含计算逻辑在内的子程序
程序的入口main()和整体流程由框架性质的平台软件执行
e.g.Hadoop, Spark

Tensorflow采取库模式，与其他环境因素解耦，高度可移植性; 没有守护进程和调度框架的开销，有助于性能优化
#### 1.3.2 组件结构
运行时核心库：安装之后，部署到site-packages中的动态链接库文件
运行时核心库的源代码分成3个层次：
* 公共运行时
实现了数据流图计算的基本逻辑
* 分布式运行时
实现了数据流图的跨进程协同计算逻辑
* 算子核函数
包含图上具体操作节点的算法实现代码

运行时核心库的底层是各种计算库和通信库
e.g. 外部组件Eigen，核心库内部StreamExecutor

最下面是操作系统和硬件基础设施
## 第2章 TensorFlow环境准备
version == 1.2.1
### 2.3 源代码结构
#### 2.3.1 根目录
符合==Bazel构建工具的规范==
* **tensorflow** : 源代码
* **thrid_party** : 部分第三方源代码以及其Bazel构建规则文件（由于第三方不包含Bazel构建规则）
* **tools** ： Bazel构建需要的环境配置脚本
* **util** ： Bazel构建需要的辅助构建规则文件
* configure ： 源代码包配置脚本
* WORKSPACE : Bazel工作空间描述，项目元信息和部分外部依赖项的下载规则
* 一些md文本说明
#### 2.3.2 tensorflow目录
* **contrib** ： 社区托管的第三方贡献组件
* **core** : 运行时核心库的源代码，C++实现
* **tools** ： 构建和运行时需要的工具程序和脚本
* **python** : python API
#### 2.3.3 tensorflow/core目录

#### 2.3.4 tensorflow/python目录

## 第3章 TensorFlow基础概念
基于==声明式编程==的数据流图作为编程范式
### 3.1 编程范式：数据流图
#### 3.1.1 声明式编程与命令式编程
* 声明式编程
结构化，抽象化，强调做什么
程序中的变量代表数学中的抽象符号，而不是内存地址
计算过程抽象为函数表达式
程序的输出定义为函数值
擅长数理计算
* 命令式编程
过程化，具体化，强调怎么做
有穷状态机，输入是起始状态，输出是结束状态，通过指令完成状态切换
#### 3.1.2 声明式编程在深度学习上的优势
* 代码可读性强
``` python
## 命令式编程
def fib(n):
    a, b = 1, 1
    for i in range(1,n):
        a, b = b, a + b
    return a

## 声明式编程
fib = lambda x : 1 if x <= 2 else fib(x - 1) + fib(x - 2) 
```

* 支持引用透明
函数副作用指当调用函数时，除了返回函数值之外，还对主调用函数产生附加的影响
如果一个函数的语义同它的上下文无关，则称为引用透明（referential transparency）
函数的调用可以被其返回值替代，不影响语义
函数更符合数学中的函数定义，而不是计算机语言中子程序的概念
==一个函数可以以闭包的形式成为另一个函数的输入==
* 提供预编译优化能力
需事先编译生成数据流图，提供预编译优化能力（并行等）

#### 3.1.3 数据流图的基本概念
用节点和有向边描述数学运算的有向无环图
* 前向图求值：用户编写代码完成
* 后向图求梯度：优化器自动生成

1. 节点
前向图中的节点称为操作：
* 数学函数或表达式
* 存储模型参数的变量
* 占位符 plcaeholder

后向图中的节点：
* 梯度值
* 更新模型参数的操作
* 更新后的模型参数

2. 有向边
定义操作间的关系：
* 传输数据---数据边（实线）
* 定义控制依赖，通过设定节点的前置依赖决定相关节点的执行顺序---控制边（虚线）

入度为0的节点可立即执行，入度非0的需要等依赖节点执行结束

3. 执行原理
* 以节点名字作为关键字，入读为值，建立散列表hashtable
* 创建可执行节点队列，将入度为0的节点加入队列，并从散列表剔除
* 依次执行该队列中的每一个节点，并将输出指向的节点入度减1
* 重复2，3步，直至可执行节点队列为空

### 3.2 数据载体：张量
* Tensor
* SparseTensor
tensorflow/python/framework/dtypes.py找到张量支持数据类型
### 3.3 模型载体：操作
### 3.4 运行载体：会话
